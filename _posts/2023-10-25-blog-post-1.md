---
title: "Alexnet input 224ï¼Ÿ227"
date: 2023-10-25
permalink: /posts/2023/10/blog-post-1/
collection: posts
toc: true
tags:
  - Alexnet
  - æ¢ç©¶ç»†èŠ‚
---
## 0.ç»“è®º 

> 1. 224çš„è¾“å…¥é…å¥—ä¼šç»™ä¸€ä¸ª`padding=2`ï¼Œ 227çš„è¾“å…¥åªæœ‰`kernel=11,stride=4`ï¼Œæ•´ä½“è®¡ç®—å¾—åˆ°ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„ç‰¹å¾è¾“å‡ºéƒ½æ˜¯55ï¼Œè¿™é‡Œæ²¡æœ‰åŒºåˆ«ã€‚
> 2. pytorchçš„å®ç°å’ŒcaffeåŸç‰ˆçš„å®ç°ç¬¬ä¸€å’Œç¬¬äºŒä¸ªå·ç§¯å±‚çš„è¾“å‡ºé€šé“æ•°ä¸åŒï¼Œä½†æ˜¯æ•´ä½“å‚æ•°é‡æ²¡æœ‰å¾ˆå¤§å˜åŒ–ï¼Œéƒ½æ˜¯6kwå·¦å³ã€‚


## 1.é—®é¢˜
<img src="https://raw.githubusercontent.com/CastleDream/CastleDream.github.io/master/images/2023-10-25/1_2_Alexnet.png" width="100%"/>

åœ¨Alexnetçš„è®ºæ–‡ä¸­ï¼Œç»“æ„å›¾ä¸Šç»™çš„è¾“å…¥æ˜¯224ï¼Œä½†æ˜¯å¦‚æœæŒ‰ç…§224å»è®¡ç®—ï¼Œå¾—åˆ°çš„ä¸‹ä¸€æ¬¡çš„è¾“å‡ºä¸æ˜¯55ï¼Œå³ï¼š

$$
\begin{aligned}
(224-11)/4+1&=&54.25 \\
(227-11)/4+1&=&55
\end{aligned}
$$

è€ŒAlexnetè®­ç»ƒæ—¶çš„æ•°æ®å¤„ç†æ­¥éª¤ä¸ºï¼š
1. ä¸‹é‡‡æ ·å¾—åˆ°$256\times 256$çš„å›¾åƒ
2. ä»256çš„å›¾åƒä¸­cropå‡º224çš„å›¾åƒ

> å› æ­¤æœ‰äººè®¤ä¸ºï¼Œåœ¨çœŸæ­£é€å…¥ç½‘ç»œä¹‹å‰ï¼Œå¯èƒ½åŠ äº†3ä¸ªåƒç´ çš„paddingï¼Œå¾—åˆ°227

## 2. è§£å†³é—®é¢˜

### 2.1 æ–‡å­—æè¿°
<img src="https://raw.githubusercontent.com/CastleDream/CastleDream.github.io/master/images/2023-10-25/1_1_wiki.png" width="100%"/>

ç±»ä¼¼çš„è¨€è®ºåœ¨[cs231çš„èµ„æ–™ä¸­](https://cs231n.github.io/convolutional-networks/)ä¹Ÿæœ‰æåŠ
> The Krizhevsky et al. architecture that won the ImageNet challenge in 2012 accepted images of size [227x227x3]

### 2.2 ä»£ç å±‚é¢
åœ¨AlexNetçš„[Caffeå®ç°](https://github.com/BVLC/caffe/blob/master/models/bvlc_alexnet/train_val.prototxt)ä¸­ï¼Œå¯ä»¥çœ‹åˆ°**ä½¿ç”¨çš„å›¾åƒå°ºå¯¸å…¶å®æ˜¯227**
```bash
name: "AlexNet"
layer {
  name: "data"
  type: "Data"
  top: "data"
  top: "label"
  include {
    phase: TRAIN
  }
  transform_param {
    mirror: true
    crop_size: 227
```

ä¸è¿‡ï¼Œåœ¨[pytorch](https://pytorch.org/vision/main/_modules/torchvision/models/alexnet.html)æˆ–è€…æ˜¯[mmpretrain](https://github.com/open-mmlab/mmpretrain/blob/main/mmpretrain/models/backbones/alexnet.py)çš„Alexnetå®ç°ä¸­ï¼Œ**ä½¿ç”¨çš„éƒ½æ˜¯224**
```python
# pytorch
[docs]class AlexNet_Weights(WeightsEnum):
    IMAGENET1K_V1 = Weights(
        url="https://download.pytorch.org/models/alexnet-owt-7be5be79.pth",
        transforms=partial(ImageClassification, crop_size=224),

# mmpretrain
@MODELS.register_module()
class AlexNet(BaseBackbone):
    """`AlexNet <https://en.wikipedia.org/wiki/AlexNet>`_ backbone.

    The input for AlexNet is a 224x224 RGB image.

    Args:
        num_classes (int): number of classes for classification.
            The default value is -1, which uses the backbone as
            a feature extractor without the top classifier.
    """
```
## 2.3 æ‰‹åŠ¨è®¡ç®—æ¯”è¾ƒ
```bash
                                           ä»¥224ä¸ºè¾“å…¥(pytorchç­‰å®ç°)
-------------------------------------------------------------------------------------------------------------------------
        Layer (type)               Output Shape         Param #                       kernel
=========================================================================================================================
            Conv2d-1           [-1, 64, 55, 55]          3*11*11*64+64=23,296         k=11,s=4,p=2 (224+4-11)/4+1=55.25
              ReLU-2           [-1, 64, 55, 55]               0
         MaxPool2d-3           [-1, 64, 27, 27]               0                       k=3, s=2, (55-3)/2+1=27
            Conv2d-4          [-1, 192, 27, 27]         64*5*5*192+192=307,392        k=5, p=2, (27+4-5)+1=27
              ReLU-5          [-1, 192, 27, 27]               0
         MaxPool2d-6          [-1, 192, 13, 13]               0                       k=3, s=2, (27-3)/2+1=13
            Conv2d-7          [-1, 384, 13, 13]         192*3*3*384+384=663,936       k=3, p=1, (13-3+2)+1=13
              ReLU-8          [-1, 384, 13, 13]               0
            Conv2d-9          [-1, 256, 13, 13]         384*3*3*256+256=884,992       k=3, p=1, (13-3+2)+1=13
             ReLU-10          [-1, 256, 13, 13]               0
           Conv2d-11          [-1, 256, 13, 13]         256*3*3*256+256=590,080       k=3, p=1, (13-3+2)+1=13
             ReLU-12          [-1, 256, 13, 13]               0
        MaxPool2d-13            [-1, 256, 6, 6]               0                       k=3, s=2, (13-3)/2+1=6
AdaptiveAvgPool2d-14            [-1, 256, 6, 6]               0                       å¯èƒ½k=3, p=1ï¼Œ(6-3+2)+1=6
          Dropout-15                 [-1, 9216]               0
           Linear-16                 [-1, 4096]      (256*6*6)9216*4096+4096=37,752,832                       
             ReLU-17                 [-1, 4096]               0
          Dropout-18                 [-1, 4096]               0
           Linear-19                 [-1, 4096]      4096*4096+4096=16,781,312
             ReLU-20                 [-1, 4096]               0
           Linear-21                 [-1, 1000]       4096*1000+1000=4,097,000
===========================================================================================================================
Total params: 61,100,840
```

```bash
                                         ä»¥227ä¸ºè¾“å…¥ï¼ˆAlexnetåŸè®ºæ–‡ï¼Œcaffeå®ç°ï¼‰
------------------------------------------------------------------------------------------------------------------------
        Layer (type)               Output Shape         Param #                       kernel
=========================================================================================================================
            Conv2d-1           ğŸ”[-1, 96, 55, 55]    3*11*11*96+96=34,944             k=11,s=4, (227-11)/4+1=55
              ReLU-2           [-1, 96, 55, 55]               0
         MaxPool2d-3           [-1, 96, 27, 27]               0                       k=3, s=2, (55-3)/2+1=27
            Conv2d-4          ğŸ”[-1, 256, 27, 27]    96*5*5*256+256=614,656           k=5, p=2, (27+4-5)+1=27
              ReLU-5          [-1, 256, 27, 27]               0
         MaxPool2d-6          [-1, 256, 13, 13]               0                       k=3, s=2, (27-3)/2+1=13
            Conv2d-7          [-1, 384, 13, 13]      256*3*3*384+384=885,120          k=3, p=1, (13-3+2)+1=13
              ReLU-8          [-1, 384, 13, 13]               0
            Conv2d-9          [-1, 256, 13, 13]      384*3*3*256+256=884,992          k=3, p=1, (13-3+2)+1=13
             ReLU-10          [-1, 256, 13, 13]               0
           Conv2d-11          [-1, 256, 13, 13]      256*3*3*256+256=590,080          k=3, p=1, (13-3+2)+1=13
             ReLU-12          [-1, 256, 13, 13]               0
        MaxPool2d-13            [-1, 256, 6, 6]               0                       k=3, s=2, (13-3)/2+1=6
AdaptiveAvgPool2d-14            [-1, 256, 6, 6]               0
          Dropout-15                 [-1, 9216]               0
           Linear-16                 [-1, 4096]      37,752,832                       
             ReLU-17                 [-1, 4096]               0
          Dropout-18                 [-1, 4096]               0
           Linear-19                 [-1, 4096]      16,781,312
             ReLU-20                 [-1, 4096]               0
           Linear-21                 [-1, 1000]       4,097,000
===========================================================================================================================
Total params: 61,640,936
```

å¯ä»¥çœ‹åˆ°ï¼Œ
+ ä¸»è¦æ˜¯å‰ä¸¤ä¸ªå·ç§¯å±‚éƒ¨åˆ†çš„è¾“å‡ºé€šé“æ•°ä¸ä¸€è‡´ï¼Œ
+ ä½†æ˜¯æ•´ä½“å‚æ•°é‡éƒ½æ˜¯6kwå·¦å³ï¼Œå‚æ•°é‡å¹¶æ²¡æœ‰å‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼Œ
+ caffeå®ç°çš„Alexnetçœ‹èµ·æ¥ç»“æ„æ›´å¯¹ç§°ä¸€äº›ã€‚




### ğŸ”—å‚è€ƒèµ„æ–™ï¼š
+ [What is the input size of Alex net](https://datascience.stackexchange.com/questions/29245/what-is-the-input-size-of-alex-net)
+ [WiKi-pedia Alexnet](https://en.wikipedia.org/wiki/AlexNet)
+ <https://cs231n.github.io/convolutional-networks/>
+ <https://github.com/BVLC/caffe/blob/master/models/bvlc_alexnet/train_val.prototxt>

